% analyze all correlations

%% load data
load condensedHurDat
load monthly_nino_data
load amm.mat
load PDO


%% Build the TC dataset
start_month =8;
end_month =10;
min_speed = -8;
start_year = 1979;
end_year = 2010;
min_lat = 5;
max_lat = 40;
max_lon = -12;
min_lon = -100;
all_storms = condensedHurDat(condensedHurDat(:,10)>min_speed, [ 1 2 6 7 ]); %filter the data by strom strength
storms = countStorms(all_storms, start_year, end_year, [start_month:end_month],[min_lat max_lat], [min_lon max_lon]);


%% build NINO data
nino12_col = 4;
nino34_col = 10;
nino3_col = 6;
nino4_col = 8;

nino34 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=8 & data(:,2)<=10),[1 2 nino34_col]);
nino12 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=8 & data(:,2)<=10),[1 2 nino12_col]);
nino3 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=8 & data(:,2)<=10),[1 2 nino3_col]);
nino4 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=8 & data(:,2)<=10),[1 2 nino4_col]);
yrs = unique(nino34(:,1));
for i =1:length(yrs) 
    nino34_aso(i) = mean(nino34(nino34(:,1)==yrs(i),3)); 
    nino12_aso(i) = mean(nino12(nino12(:,1)==yrs(i),3)); 
    nino3_aso(i) = mean(nino3(nino3(:,1)==yrs(i),3)); 
    nino4_aso(i) = mean(nino4(nino4(:,1)==yrs(i),3)); 
end

nino34 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=3 & data(:,2)<=10),[1 2 nino34_col]);
nino12 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=3 & data(:,2)<=10),[1 2 nino12_col]);
nino3 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=3 & data(:,2)<=10),[1 2 nino3_col]);
nino4 = data((data(:,1)>=start_year & data(:,1) <=end_year & data(:,2)>=3 & data(:,2)<=10),[1 2 nino4_col]);
for i =1:length(yrs) 
    nino34_mo(i) = mean(nino34(nino34(:,1)==yrs(i),3)); 
    nino12_mo(i) = mean(nino12(nino12(:,1)==yrs(i),3)); 
    nino3_mo(i) = mean(nino3(nino3(:,1)==yrs(i),3)); 
    nino4_mo(i) = mean(nino4(nino4(:,1)==yrs(i),3)); 
end

%% build AMM data
amm = AMM(AMM(:,1)>=start_year & AMM(:,1)<=end_year, 9:11);
amm_aso = mean(amm,2);
amm = AMM(AMM(:,1)>=start_year & AMM(:,1)<=end_year, 4:11);
amm_mo = mean(amm,2);

%% load EOF data
atl_aso = load('augOctAtlanticBasinEOFPCs');
pac_aso = load('augOctPacificBasinEOFPCs');
joint_aso = load('augOctPacificBasinEOFPCs');

atl_mo = load('marOctAtlanticBasinEOFPCs');
pac_mo = load('marOctPacificBasinEOFPCs');
joint_mo = load('marOctPacificBasinEOFPCs');

%% load Pacific index data
load('regression_model_sst_data','pacific_indices_aug_oct','pacific_indices_mar_oct');

%% build correlation matrix
combo_index_aug_oct = [-4.79671138638075
-0.922282544778101
-3.50299022399193
-6.05675794320586
-4.68331855601023
-1.69876174139859
-4.76817964695267
-7.15227357095658
-4.84847146862352
-0.0716211372245468
-2.45486697854207
-5.38759624198100
-6.12122675892083
-6.38791369135087
-4.73920817270733
-4.96914018354043
1.11983070312858
-3.23240856919108
-8.56641888044925
1.85363762822818
-0.733603830619603
-1.12785440589547
-0.272763684738441
-2.98979582551043
-1.90262978351874
-3.80896036302922
1.07798391664600
-3.52162757316671
-0.307841875179156
-0.605017198880449
-5.97144873620474
2.85630944160957
];

combo_index_mar_oct = [2.22858422847212
5.36089780317023
3.70359500652564
1.34719221037401
-0.408903252871383
4.40707801154260
6.00976094308073
1.71068800929171
2.71868280256575
7.81237666021653
2.68979976409023
3.05937795444799
4.57969262213585
3.90930072483044
2.69566003622379
0.614996306560187
6.80973343840685
5.18199093686942
-0.982514017084510
5.17861601706000
8.58094281512356
6.53092411353000
4.87812200467641
5.61868632293308
7.99415955834326
6.02021642039585
10.1766367013285
7.39042835595663
7.53694883696431
8.10201856886913
5.61349154860191
12.7899808918514
];
predictors = [nino34_aso' nino12_aso' nino3_aso' nino4_aso' nino34_mo' nino12_mo' nino3_mo' nino4_mo' amm_aso amm_mo augOctPDO marOctPDO...
    atl_aso.PCs(:,1:5) pac_aso.PCs(:,1:5) joint_aso.PCs(:,1:5) atl_mo.PCs(:,1:5) pac_mo.PCs(:,1:5) joint_mo.PCs(:,1:5) pacific_indices_aug_oct pacific_indices_mar_oct combo_index_aug_oct combo_index_mar_oct storms'];

for i=1:size(predictors,2)
    for j=1:size(predictors,2)
        cc(i,j) = corr(predictors(:,i),predictors(:,j));
    end
end
